<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="29-03-2025 12:28:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>
        <sql>
            create table users
            (
                username varchar(20) not null,
                password varchar(20) not null,
                enabled  boolean     not null default true,
                constraint pk_users primary key (username)
            );
        </sql>
    </changeSet>

    <changeSet id="29-03-2025 13:07:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="roles"/>
            </not>
        </preConditions>
        <sql>
            create table roles
            (
                id       bigint generated by default as identity primary key,
                username varchar(20) not null,
                role     varchar(20) not null,
                foreign key (username) references users (username),
                constraint uni_username_role unique (role, username)
            );
        </sql>
    </changeSet>

    <changeSet id="29-03-2025 13:57:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="locations"/>
            </not>
        </preConditions>
        <sql>
            create table locations
            (
                id      bigint generated by default as identity primary key,
                name    varchar(100) not null,
                country varchar(100) not null,
                city    varchar(100) not null,
                code    varchar(10)  not null unique
            );
        </sql>
    </changeSet>

    <changeSet id="29-03-2025 14:05:00" author="Fatih Bozik">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="transportations"/>
            </not>
        </preConditions>
        <sql>
            create table transportations
            (
                id                      bigint generated by default as identity primary key,
                origin_location_id      bigint      not null,
                destination_location_id bigint      not null,
                type                    varchar(20) not null check (type in ('FLIGHT', 'BUS', 'SUBWAY', 'UBER')),
                operating_days          integer[] not null,

                constraint fk_origin foreign key (origin_location_id) references locations (id),
                constraint fk_destination foreign key (destination_location_id) references locations (id)
            );
        </sql>
    </changeSet>
</databaseChangeLog>
